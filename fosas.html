{% extends "_fosas_base.html" %}

{% block content %}
<div class="container">
  <h1>Fosas</h1>
  <div id="map" style="width: 100%; height: 500px;"></div>
</div>
{% endblock %}

{% block css %}
{{ super() }}
<link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.2/leaflet.css" />
{% endblock %}

{% block scripts %}
<script type="text/template" id="popup-template">
  <h2><%= localizacion %></h2>
  <p>Fosas: <%= fosas %></p>
  <p>Cuerpos: <%= cuerpos %></p>
  <p>AÃ±o: <%= anio %></p>
</script>
<script src="//cdnjs.cloudflare.com/ajax/libs/underscore.js/1.6.0/underscore-min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.2/leaflet.js" type="text/javascript"></script>
<script type="text/javascript" src="http://maps.stamen.com/js/tile.stamen.js?v1.2.4"></script>
<script>
$(document).ready(function() {
  var template = _.template($("#popup-template").html());

  var map = L.map('map', {
      center: [21.651685, -99.820863],
      zoom: 5
  });
  var base = new L.StamenTileLayer("toner-lite");
  map.addLayer(base);

  {% for location in fosas_locations %}
    var marker = L.marker([{{ location.lat }}, {{ location.lon }}]).addTo(map);
    var content = template({
      localizacion: "{{ location.localizacion }}",
      fosas: {{ location.fosas or 0 }},
      cuerpos: {{ location.cuerpos or 0 }},
      anio: {{ location.anio or 0 }},
    });
    marker.bindPopup(content);
  {% endfor %}
});

</script>
{% endblock %}
